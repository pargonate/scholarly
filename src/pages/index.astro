---
import Layout from "../layouts/Layout.astro";
import { Icon } from 'astro-icon/components';
import { XataClient } from "../xata";

const xata = new XataClient({
	apiKey: import.meta.env.XATA_API_KEY,
	branch: import.meta.env.XATA_BRANCH
});

const { records } = await xata.db.courses.getPaginated({
	pagination: {
		size: 50
	}
}).catch(error => {
	console.error("ðŸ›‘ Error fetching courses:", error);
	alert("Error fetching courses. Please try again later.");
	return { records: [] };
});

console.log(records);
---
<Layout title="Index" description="Index">
	<table>
		<thead>
			<tr>
				<th>Course Name</th>
				<th>Course Subject</th>
				<th>Course Description</th>
				<th>Course Credits</th>
			</tr>
		</thead>
		<tbody>
			{records.map((course) => (
				<tr>
					<td>
						<div id="courseName-wrapper">
							{course.name} ({course.id})
							<div id="courseControls">
								<a href={`/composer?mode=modify&id=${course.id}`} class="courseControl">
									<Icon name="ri:pencil-fill" />
								</a>
								<Icon name="ri:delete-bin-5-line" />
							</div>
						</div>
					</td>
					<td>{course.subject}</td>
					<td>{course.description}</td>
					<td>{course.credits}</td>
				</tr>
			))}
		</tbody>
	</table>
	<!-- <div id="control-panel">
		<a href=""></a>
	</div> -->
	<style>
		table {
			border-collapse: collapse;
			width: 100%;
		}

		th,
		td {
			border: 1px solid #ddd;
			padding: 8px;
		}

		#courseName-wrapper {
			display: flex;
			gap: 15px;
		}

			#courseControls {
				display: flex;
				align-items: center;
				justify-content: center;
				gap: 5px;
			}

		.courseControl {
			all: unset;
			line-height: 0px;
		}

		th {
			background-color: #f2f2f2;
			text-align: left;
		}
	</style>
</Layout>
